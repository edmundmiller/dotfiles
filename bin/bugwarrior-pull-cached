#!/usr/bin/env bash
# 
# Bugwarrior pull with 1Password session caching
#

set -euo pipefail

# Cache the 1Password session for 30 minutes
export OP_SESSION_CACHE_TIMEOUT=1800

# Sign in to 1Password if needed
if ! op account list &>/dev/null; then
    eval $(op signin)
fi

# Export the session token so child processes can use it
export $(env | grep '^OP_SESSION_' || true)

# Change to bugwarrior directory and run
cd ~/src/personal/taskagent/bugwarrior
exec uv run bugwarrior pull "$@"