#!/usr/bin/env bash

# Nix's CLI has a poor user story, in my opinion. It could be better; Guix is a
# good role model here. I wrote this script to abstract the more common
# workflows, like rebuilding (nixos-rebuild), cleaning up (nix-collect-garbage),
# package/env management (nix-env), updating, rolling back, etc. As well as some
# utility operations (like managing generations, building remotely, or swapping
# themes on the fly).
#
# Because I can go months without shaving yaks in NixOS, exact flags or details
# are often and easily forgotten. This spares me that fumbling phase and also
# serves as a reference.

# Check if just is available, if not use nix shell
if ! command -v just >/dev/null 2>&1; then
  echo "just not found, running via nix shell..."
  exec nix shell nixpkgs#just -c just --justfile "$0.just" --working-directory "$(dirname "$0")/.." "$@"
else
  exec just --justfile "$0.just" --working-directory "$(dirname "$0")/.." "$@"
fi