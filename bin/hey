#!/usr/bin/env -S just --justfile
# A modular interface to nix-darwin/nixos operations using JustScripts
# Inspired by Henrik Lissner's dotfiles

import 'hey.d/common.just'
import 'hey.d/rebuild.just'
import 'hey.d/flake.just'
import 'hey.d/nix.just'
import 'hey.d/remote.just'
import 'hey.d/test.just'
import 'hey.d/ergodox.just'

# Default recipe - show help
default: help

# Show help message
help:
    @echo "Usage: hey <command> [args...] (powered by just)"
    @echo ""
    @echo "System Commands:"
    @echo "  rebuild, re [args]    Rebuild the system (default: switch)"
    @echo "  test [args]          Build and activate but don't add to boot menu"
    @echo "  rollback             Roll back to previous generation"
    @echo ""
    @echo "Remote Deployment:"
    @echo "  nuc                  Deploy to NUC (remote build)"
    @echo "  rebuild-nuc          Alias for nuc"
    @echo "  nuc-test             Test NUC config without adding to boot"
    @echo "  nuc-status           Show NUC system status"
    @echo "  nuc-ssh              SSH into NUC"
    @echo "  nuc-service <name>   Check service status on NUC"
    @echo "  nuc-logs [unit]      View NUC system logs"
    @echo "  nuc-rollback         Roll back NUC to previous generation"
    @echo "  nuc-generations      List NUC system generations"
    @echo "  nuc-local            Build NUC config locally (slow on ARM Mac)"
    @echo ""
    @echo "Flake Commands:"
    @echo "  update, u [inputs]   Update flake inputs (all if none specified)"
    @echo "  upgrade              Update inputs and rebuild system"
    @echo "  check                Run flake checks"
    @echo "  show                 Show flake outputs"
    @echo ""
    @echo "Nix Commands:"
    @echo "  gc                   Run garbage collection"
    @echo "  repl                 Open nix repl with flake loaded"
    @echo "  search <query>       Search nixpkgs for packages"
    @echo "  shell <package>      Start shell with package available"
    @echo ""
    @echo "Test Commands:"
    @echo "  ztest [file]         Run zunit tests (all if none specified)"
    @echo ""
    @echo "ErgoDox Commands:"
    @echo "  ergodox-flash [hex]  Flash firmware (default: ergo-drifter)"
    @echo "  ergodox-build        Build firmware from source using QMK"
    @echo "  ergodox-build-flash  Build and flash firmware"
    @echo "  ergodox-info         Show firmware info and paths"
    @echo ""
    @echo "Examples:"
    @echo "  hey rebuild          # Rebuild and switch local system"
    @echo "  hey nuc              # Deploy to NUC server"
    @echo "  hey nuc-status       # Check NUC system status"
    @echo "  hey test             # Test build without switching"
    @echo "  hey update nixpkgs   # Update only nixpkgs input"
    @echo "  hey search firefox   # Search for firefox packages"
    @echo ""
    @echo "Current flake host: {{flake_host}}"
    @echo "Platform: $(if {{is_darwin}}; then echo Darwin; else echo NixOS; fi)"