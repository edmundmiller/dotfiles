# Worktrunk User Configuration
# Managed via nix-darwin dotfiles
# Symlinked to ~/.config/worktrunk/config.toml

# Worktree Path Template
# Variables:
#   {{ repo }}                 - Repository directory name (e.g., "myproject")
#   {{ branch }}               - Raw branch name (e.g., "feature/auth")
#   {{ branch | sanitize }}    - Filesystem-safe: / and \ replaced by - (e.g., "feature-auth")
#   {{ branch | sanitize_db }} - Database-safe: lowercase, underscores, hash suffix
#   {{ branch | hash_port }}   - Deterministic port 10000-19999
#
# Paths are relative to the main worktree root (original repository directory).
#
# Example paths created (repo at /Users/emiller/code/myproject, branch feature/auth):
#   "../{{ repo }}.{{ branch | sanitize }}" → /Users/emiller/code/myproject.feature-auth
#   ".worktrees/{{ branch | sanitize }}"    → /Users/emiller/code/myproject/.worktrees/feature-auth
#   "../worktrees/{{ repo }}/{{ branch | sanitize }}" → /Users/emiller/code/worktrees/myproject/feature-auth

worktree-path = "../{{ repo }}.{{ branch | sanitize }}"

# Alternative patterns (uncomment to use):
# Inside repo (like beads): worktree-path = ".worktrees/{{ branch | sanitize }}"
# Bare repo style: worktree-path = "../{{ branch | sanitize }}"
# Namespaced: worktree-path = "../worktrees/{{ repo }}/{{ branch | sanitize }}"

# LLM Commit Message Generation
# Requires: pip install llm llm-anthropic
# See: https://github.com/simonw/llm
[commit-generation]
command = "llm"
args = ["-m", "claude-haiku-4.5"]

# Optional: Custom prompt template (uses minijinja syntax)
# Available variables: {{ git_diff }}, {{ git_diff_stat }}, {{ branch }}, {{ recent_commits }}, {{ repo }}
# template = """
# Write a commit message for the staged changes below.
# 
# <format>
# - Subject under 50 chars, blank line, then optional body
# - Output only the commit message, no quotes or code blocks
# </format>
# 
# <style>
# - Imperative mood: "Add feature" not "Added feature"
# - Match recent commit style (conventional commits if used)
# - Describe the change, not the intent or benefit
# </style>
# 
# <diffstat>
# {{ git_diff_stat }}
# </diffstat>
# 
# <diff>
# {{ git_diff }}
# </diff>
# 
# <context>
# Branch: {{ branch }}
# {% if recent_commits %}<recent_commits>
# {% for commit in recent_commits %}- {{ commit }}
# {% endfor %}</recent_commits>{% endif %}
# </context>
# """

# List Command Defaults
# Configure default behavior for `wt list`
[list]
full = false       # Show CI and default-branch merge-base diffstat by default
branches = false   # Include branches without worktrees by default
remotes = false    # Include remote branches by default

# Commit Defaults (shared by `wt step commit`, `wt step squash`, and `wt merge`)
[commit]
stage = "all"      # What to stage: "all", "tracked", or "none"

# Merge Command Defaults
[merge]
squash = true      # Squash commits when merging
commit = true      # Commit uncommitted changes during merge
rebase = true      # Rebase onto target before merging
remove = true      # Remove worktree after merge
verify = true      # Run project hooks (pre-commit, pre-merge)

# Select Command Defaults
# Configure pager behavior for `wt select` diff previews
[select]
# Pager command with flags for diff preview (overrides git's core.pager)
# Example: pager = "delta --paging=never"

# Approved Commands
# Commands approved for project hooks in repos
# Auto-populated when approving hooks (prompt on first run) or via `wt hook approvals add`
# 
# Example:
# [projects."github.com/edmundmiller/dotfiles"]
# approved-commands = ["hey check", "terminal-notifier"]
