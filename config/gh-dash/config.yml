# yaml-language-server: $schema=https://gh-dash.dev/schema.json
# GitHub Dashboard Configuration
# Graphite-inspired PR inbox with stacked PR support and jj-spr integration

prSections:
  # Immediate Action Required
  - title: "Needs My Review (Urgent)"
    filters: review-requested:@me is:open sort:updated-asc
    limit: 10

  - title: "Changes Requested (My PRs)"
    filters: author:@me is:open review:changes_requested sort:updated-desc
    limit: 15

  - title: "Approved & Ready to Merge"
    filters: author:@me is:open review:approved status:success -is:draft sort:updated-desc
    limit: 10

  # Stacked PR Tracking
  - title: "My Stacks (Base: main)"
    filters: author:@me is:open base:main sort:created-desc
    limit: 20

  - title: "Dependent PRs (Stacked)"
    filters: author:@me is:open -base:main -base:master sort:updated-desc
    limit: 20

  - title: "Stack Activity (Recent)"
    filters: author:@me is:open sort:updated-desc
    limit: 15

  # Active Work
  - title: "My Open PRs (Active)"
    filters: author:@me is:open -is:draft sort:updated-desc
    limit: 25

  - title: "My Drafts"
    filters: is:draft author:@me sort:updated-desc
    limit: 10

  # Team Coordination
  - title: "Awaiting My Review"
    filters: review-requested:@me is:open sort:updated-desc
    limit: 30

  - title: "My PRs Awaiting Review"
    filters: author:@me is:open review:none draft:false sort:updated-desc
    limit: 15

  - title: "Mentioned Me"
    filters: mentions:@me -author:@me is:open sort:updated-desc
    limit: 15

  - title: "Team Discussions"
    filters: involves:@me comments:>3 is:open sort:comments-desc
    limit: 10

  # Organization-Specific
  - title: "nf-core PRs"
    filters: org:nf-core involves:@me is:open sort:updated-desc
    limit: 25

  - title: "Nextflow PRs"
    filters: org:nextflow-io involves:@me is:open sort:updated-desc
    limit: 20

  - title: "Seqera PRs"
    filters: org:seqeralabs involves:@me is:open sort:updated-desc
    limit: 25

  # Maintenance
  - title: "Dependabot PRs"
    filters: author:app/dependabot involves:@me is:open sort:created-desc
    limit: 25

  - title: "Stale PRs"
    filters: author:@me is:open sort:updated-asc
    limit: 10

issuesSections:
  - title: "My Issues"
    filters: author:@me is:open sort:updated-desc
    limit: 15

  - title: "Assigned to Me"
    filters: assignee:@me is:open sort:updated-desc
    limit: 20

  - title: "nf-core Issues"
    filters: org:nf-core involves:@me is:open sort:reactions-desc
    limit: 20

  - title: "Seqera Issues"
    filters: org:seqeralabs involves:@me is:open sort:updated-desc
    limit: 15

  - title: "Hot Issues"
    filters: involves:@me is:open sort:reactions-desc
    limit: 10

defaults:
  view: prs
  prsLimit: 25
  issuesLimit: 20
  refetchIntervalMinutes: 30
  preview:
    open: true
    width: 55

repoPaths:
  nf-core/*: ~/src/nf-core/*
  seqeralabs/*: ~/src/seqera/*
  seqera-services/*: ~/src/seqera/*
  nextflow-io/*: ~/src/nextflow/*
  ":owner/:repo": ~/src/:owner/:repo

# Quick Search Patterns (use with / key):
# Seqera work: org:seqeralabs OR org:seqera-services OR org:nextflow-io
# nf-core work: org:nf-core
# Combined: (org:seqeralabs OR org:nf-core) involves:@me

keybindings:
  universal:
    - key: b
      command: open https://github.com/{{.RepoName}}
      name: Open repo in browser

    - key: "y"
      command: echo "https://github.com/{{.RepoName}}/pull/{{.PrNumber}}" | pbcopy
      name: Copy PR URL

  prs:
    - key: o
      command: open https://github.com/{{.RepoName}}/pull/{{.PrNumber}}
      name: Open PR in browser

    - key: O
      command: cd {{.RepoPath}} && gh pr checkout {{.PrNumber}}
      name: Checkout PR locally

    - key: a
      command: gh pr review {{.PrNumber}} --repo {{.RepoName}} --approve --body "LGTM! âœ…"
      name: Quick approve

    - key: A
      command: gh pr review {{.PrNumber}} --repo {{.RepoName}} --approve
      name: Approve with comment

    - key: r
      command: gh pr review {{.PrNumber}} --repo {{.RepoName}} --request-changes
      name: Request changes

    - key: m
      command: gh pr merge {{.PrNumber}} --repo {{.RepoName}} --squash
      name: Merge with squash

    - key: R
      command: gh pr ready {{.PrNumber}} --repo {{.RepoName}}
      name: Mark draft as ready

    - key: d
      command: GH_FORCE_TTY=1 gh pr diff {{.PrNumber}} --repo {{.RepoName}} | delta
      name: View diff

    - key: c
      command: gh pr comment {{.PrNumber}} --repo {{.RepoName}}
      name: Add comment

    - key: J
      command: cd {{.RepoPath}} && jj-spr land {{.PrNumber}}
      name: Land PR with jj-spr

    - key: S
      command: cd {{.RepoPath}} && jj-spr status
      name: Show stack status

  issues:
    - key: o
      command: open https://github.com/{{.RepoName}}/issues/{{.IssueNumber}}
      name: Open issue in browser

    - key: c
      command: gh issue comment {{.IssueNumber}} --repo {{.RepoName}}
      name: Add comment

    - key: x
      command: gh issue close {{.IssueNumber}} --repo {{.RepoName}}
      name: Close issue

    - key: X
      command: gh issue reopen {{.IssueNumber}} --repo {{.RepoName}}
      name: Reopen issue

theme:
  colors:
    text:
      primary: "#cdd6f4"
      secondary: "#a6adc8"
      inverted: "#1e1e2e"
      faint: "#6c7086"
      warning: "#f9e2af"
      success: "#a6e3a1"
    background:
      selected: "#45475a"
    border:
      primary: "#6c7086"
      secondary: "#45475a"
      faint: "#313244"
