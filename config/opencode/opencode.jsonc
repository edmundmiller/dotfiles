{
    "$schema": "https://opencode.ai/config.json",
    // Theme - Catppuccin Mocha for consistency with Ghostty/Neovim/Taskwarrior
    "theme": "catppuccin",
    // TUI settings
    "tui": {
        "scroll_acceleration": {
            "enabled": true
        }
    },
    // Model configuration - using Claude as primary
    "model": "anthropic/claude-sonnet-4-5",
    "small_model": "anthropic/claude-haiku-4-5",
    // Provider configuration
    "provider": {
        "anthropic": {
            "options": {
                "apiKey": "{env:ANTHROPIC_API_KEY}"
            }
        }
    },
    // Autoupdate - notify but don't auto-update
    "autoupdate": "notify",
    // Plugins
    // - opencode-pty: PTY support for interactive terminal sessions
    // - opencode-wakatime: Track coding time with WakaTime (requires ~/.wakatime.cfg)
    // - opencode-md-table-formatter: Auto-format markdown tables on completion
    // - opencode-notifier: Desktop notifications + sounds on events
    // - opencode-jj: Enforce JJ describe-before-implement workflow
    // - opencode-direnv: Auto-load .envrc environment variables at session start
    // - opencode-dcp: Dynamic context pruning to reduce token usage (MUST BE LAST)
    // - opencode-beads: Beads issue tracker integration
    "plugin": [
        "opencode-pty",
        "@simonwjackson/opencode-direnv",
        "opencode-wakatime",
        "@franlol/opencode-md-table-formatter@latest",
        "@mohak34/opencode-notifier",
        "opencode-beads",
        "@tarquinen/opencode-smart-title",
        "@tarquinen/opencode-dcp@latest",
        "opencode-gemini-auth@latest",
        // Local plugins (in ~/.config/opencode/plugin/)
        "./plugin/opencode-jj",
        "./plugin/boomerang-notify"
    ],
    // Nextflow Language Server
    "lsp": {
        "nextflow": {
            "command": [
                "java",
                "-jar",
                "{env:HOME}/.local/share/opencode/bin/nextflow-language-server/language-server-all.jar"
            ],
            "extensions": [
                ".nf",
                ".config"
            ]
        }
    },
    // MCP servers
    "mcp": {
        "seqera-platform": {
            "type": "remote",
            "url": "https://mcp.seqera.io/mcp",
            "enabled": false,
            "headers": {
                "Authorization": "Bearer {env:SEQERA_TOKEN}"
            },
            "timeout": 10000
        },
        "context7": {
            "type": "remote",
            "url": "https://mcp.context7.com/mcp",
            "enabled": true,
            "headers": {
                "CONTEXT7_API_KEY": "{env:CONTEXT7_API_KEY}"
            }
        }
    },
    // Permission configuration - permissive default with targeted safety guards
    "permission": {
        "bash": {
            // Default: allow most commands (we use JJ, everything is undoable)
            "*": "allow",

            // === INTERACTIVE COMMANDS (will hang - block them) ===
            // Git interactive
            "git add -i *": "deny",
            "git add -p *": "deny",
            "git add --interactive *": "deny",
            "git add --patch *": "deny",
            "git rebase -i *": "deny",
            "git rebase --interactive *": "deny",
            "git commit": "deny",
            "git commit -a": "deny",
            // JJ interactive (editors)
            "jj describe": "deny",
            "jj split": "deny",
            "jj squash": "deny",
            "jj commit": "deny",
            // Editors/pagers (will hang)
            "vim *": "deny",
            "vi *": "deny",
            "nano *": "deny",
            "emacs *": "deny",
            "less": "deny",
            "more": "deny",
            "man *": "deny",

            // === DESTRUCTIVE OPERATIONS (ask first) ===
            // System destruction
            "rm -rf /": "deny",
            "rm -rf /*": "deny",
            "sudo rm -rf *": "ask",
            "chmod -R 777 *": "ask",
            // Git force operations
            "git push --force *": "ask",
            "git push -f *": "ask",
            "git reset --hard *": "ask",
            // Nix/Darwin system changes
            "nix-collect-garbage *": "ask",
            "darwin-rebuild *": "ask",
            // Docker cleanup
            "docker system prune *": "ask",
            // Package removal
            "brew uninstall *": "ask",
            "pip uninstall *": "ask",
            "npm uninstall -g *": "ask",
            // Seqera Platform destructive
            "tw pipelines delete *": "ask",
            "tw runs delete *": "ask",
            "tw datasets delete *": "ask",
            "tw compute-envs delete *": "ask",
            // nf-core modifications
            "nf-core create *": "ask",
            "nf-core modules install *": "ask",
            "nf-core modules remove *": "ask",
            "nf-core launch *": "ask"
        },
        "edit": "allow",
        "write": "allow",
        "webfetch": "allow",
        "doom_loop": "allow",
        "external_directory": "ask"
    },
    // Nextflow development agents
    "agent": {
        // Built-in agent overrides
        "build": {
            "mode": "primary",
            "model": "anthropic/claude-opus-4-5",
            "description": "Full development work with all tools enabled"
        },
        "plan": {
            "mode": "primary",
            "model": "anthropic/claude-sonnet-4-5",
            "description": "Analysis and planning without making changes",
            "permission": {
                "edit": "ask",
                "write": "ask",
                "bash": {
                    // Default allow for read operations
                    "*": "allow",
                    // Block file modifications
                    "rm *": "ask",
                    "mv *": "ask",
                    "cp *": "ask",
                    "mkdir *": "ask",
                    "touch *": "ask",
                    "chmod *": "ask",
                    // Block git/jj writes
                    "git add *": "ask",
                    "git commit *": "ask",
                    "git push *": "ask",
                    "git merge *": "ask",
                    "jj new *": "ask",
                    "jj describe *": "ask",
                    "jj squash *": "ask",
                    // Block package installs
                    "npm install *": "ask",
                    "pip install *": "ask",
                    "brew install *": "ask",
                    // Block docker writes
                    "docker run *": "ask",
                    "docker build *": "ask",
                    "docker rm *": "ask",
                    // Block beads modifications
                    "bd create *": "ask",
                    "bd update *": "ask",
                    "bd close *": "ask"
                },
                "list": "allow"
            }
        },
        "nextflow-dev": {
            "description": "Nextflow pipeline development agent with enhanced permissions for workflow development",
            "mode": "subagent",
            "temperature": 0.3,
            "permission": {
                "bash": {
                    "nextflow clean *": "allow",
                    "nf-core download *": "allow"
                },
                "edit": "allow",
                "write": "allow",
                "webfetch": "allow"
            }
        },
        "nextflow-debug": {
            "description": "Debugging agent for Nextflow - read-focused with work directory inspection capabilities",
            "mode": "subagent",
            "temperature": 0.1,
            "permission": {
                "bash": {
                    "nextflow log *": "allow",
                    "nextflow config": "allow",
                    "nf-test list *": "allow"
                },
                "edit": "deny",
                "write": "deny",
                "webfetch": "allow"
            }
        },
        "pipeline-review": {
            "description": "Code review agent - read-only with static analysis and linting capabilities",
            "mode": "subagent",
            "temperature": 0.2,
            "permission": {
                "bash": {
                    "nextflow config *": "allow",
                    "nextflow lint *": "allow",
                    "nf-core lint *": "allow",
                    "nf-test list": "allow",
                    "ast-grep scan *": "allow",
                    "ast-grep -p *": "allow"
                },
                "edit": "deny",
                "write": "deny",
                "webfetch": "ask"
            }
        }
    },
    // Instructions - consolidated (reduced from ~287 to ~70 lines)
    "instructions": [
        "~/.config/opencode/INSTRUCTIONS.md",
        "~/.config/opencode/rules/jj-beads-merge.md",
        "~/.config/opencode/rules/skill-locations.md"
    ]
}
