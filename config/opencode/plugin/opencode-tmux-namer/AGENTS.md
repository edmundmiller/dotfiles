# opencode-tmux-namer

## Purpose

OpenCode plugin that dynamically renames tmux windows based on project context and agent status.

## Directory Structure

```
opencode-tmux-namer/
├── src/
│   └── index.ts      # Main plugin implementation (TypeScript source)
├── dist/             # Compiled output (generated by `bun run build`)
│   ├── index.js      # Compiled JavaScript
│   └── index.d.ts    # Type declarations
├── package.json      # Plugin metadata, scripts, dependencies
├── tsconfig.json     # TypeScript configuration
├── AGENTS.md         # This file
└── README.md         # User documentation
```

## Development Commands

```bash
bun install          # Install dependencies
bun run build        # Compile TypeScript to dist/
bun run check        # Type-check without emitting
bun test             # Run tests
```

**Important:** Must run `bun run build` after any changes to `src/index.ts`.

## Plugin Events Used

- `session.status` - Real-time busy/idle/waiting status
- `session.idle` - Agent finished working
- `file.edited` - Track file changes for context
- `command.executed` - Track commands for intent inference
- `todo.updated` - Track todos for context
- `permission.updated` / `permission.replied` - Detect waiting state

## Status Icons

| Icon | Status | Trigger |
|------|--------|---------|
| `●` | Busy | session.status = running/streaming |
| `□` | Idle | session.status = idle/completed, session.idle event |
| `■` | Waiting | permission.updated, permission.replied |
| `▲` | Error | session.status = error/failed |
| `◇` | Unknown | Default/no status |

## Naming Logic

1. **Project**: package.json name > git remote > directory name
2. **Intent**: Inferred from signals (test, debug, fix, refactor, doc, review, ops, spike, feat)
3. **Tag**: Inferred from signals (auth, api, db, cache, ui, nf, nix, term)

## Environment Variables

```bash
OPENCODE_TMUX_DEBUG=1           # Enable debug logging
OPENCODE_TMUX_COOLDOWN_MS=300000 # 5min between renames
OPENCODE_TMUX_DEBOUNCE_MS=5000   # 5s debounce
OPENCODE_TMUX_SHOW_STATUS=1      # Include status icons
```

## Relation to tmux-opencode-integrated

This is a **native OpenCode plugin** with direct event access.
`tmux-opencode-integrated` is an **external Python script** that pattern-matches pane content.

Use both:
- This plugin for accurate status (has direct event access)
- tmux-opencode-integrated for Agent Management Panel (`<prefix> A`)

## Key Functions in src/index.ts

| Function | Purpose |
|----------|---------|
| `TmuxNamer` | Main plugin factory, exported as default |
| `loadConfig()` | Load env vars into PluginConfig |
| `findTmux()` | Locate tmux binary |
| `getProjectName()` | Extract project name from pkg.json/git/dir |
| `inferIntent()` | Pattern match signals → intent (feat/fix/debug/etc) |
| `inferTag()` | Pattern match signals → tag (auth/api/db/etc) |
| `buildName()` | Construct `[icon] project-intent-tag` string |
| `renameWindow()` | Call `tmux rename-window` |
| `mapSessionStatus()` | Map OpenCode status strings → Status enum |

## Adding New Intents/Tags

Edit `inferIntent()` or `inferTag()` in `src/index.ts`:

```typescript
// Add new intent pattern
if (/\b(migrate|migration|schema)\b/.test(t)) return "migrate";

// Add new tag pattern
[/\b(graphql|gql)\b/, "gql"],
```

Then rebuild: `bun run build`
