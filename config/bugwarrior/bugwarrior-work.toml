# Bugwarrior configuration for work machine (Seqeratop)
# Credentials via manual files in ~/.config/bugwarrior/secrets/

[general]
targets = [
    "seqera_jira_sdoc",
    "seqera_jira_other",
    "github_seqera_issues",
    "github_seqera_authored_prs",
    "github_seqera_review_requests",
    "github_seqera_assigned_prs",
    "github_nfcore_issues",
    "github_nfcore_authored_prs",
    "github_nfcore_review_requests",
    "github_nfcore_assigned_prs",
    # "work_gmail",  # TODO: requires OAuth setup (see bead dotfiles-l6h)
]
taskrc = "~/.taskrc"
log_level = "INFO"
annotation_links = true
merge_annotations = true
merge_tags = true
reopen_completed_tasks = false

# =============================================================================
# Jira
# =============================================================================

# SDOC and SH projects - active work, show in work context
[seqera_jira_sdoc]
service = "jira"
base_uri = "@oracle:eval:cat ~/.config/bugwarrior/secrets/jira-host"
username = "@oracle:eval:cat ~/.config/bugwarrior/secrets/jira-username"
password = "@oracle:eval:cat ~/.config/bugwarrior/secrets/jira-password"
description_template = "{{jirasummary}}"
project_template = "{{jiraproject}}"
query = "(assignee = currentUser() OR reporter = currentUser()) AND resolution is null AND project in (SDOC, SH)"
import_labels_as_tags = true
import_sprints_as_tags = true
label_template = "{{label}}"
# Import priority field from Jira (priority.name contains: Highest, High, Medium, Low, Lowest)
extra_fields = ["jirapriority:priority.name"]
priority_template = "{% if jirapriority == 'Highest' %}ASAP{% elif jirapriority == 'High' %}H{% elif jirapriority == 'Low' or jirapriority == 'Lowest' %}L{% else %}M{% endif %}"
add_tags = ["jira", "jira_active", "bw"]
area_template = "seqera"
# Map Jira status to TaskWarrior status
status_map = [
    { upstream = "Backlog", taskwarrior = "waiting" },
    { upstream = "To Do", taskwarrior = "pending" },
    { upstream = "In Progress", taskwarrior = "pending" },
    { upstream = "In Review", taskwarrior = "pending" },
    { upstream = "Blocked", taskwarrior = "waiting" },
]

# Other JIRA projects - bulk cleanup needed, hide from work context
[seqera_jira_other]
service = "jira"
base_uri = "@oracle:eval:cat ~/.config/bugwarrior/secrets/jira-host"
username = "@oracle:eval:cat ~/.config/bugwarrior/secrets/jira-username"
password = "@oracle:eval:cat ~/.config/bugwarrior/secrets/jira-password"
description_template = "{{jirasummary}}"
project_template = "{{jiraproject}}"
query = "(assignee = currentUser() OR reporter = currentUser()) AND resolution is null AND project not in (SDOC, SH)"
import_labels_as_tags = true
import_sprints_as_tags = true
label_template = "{{label}}"
# Import priority field from Jira (priority.name contains: Highest, High, Medium, Low, Lowest)
extra_fields = ["jirapriority:priority.name"]
priority_template = "{% if jirapriority == 'Highest' %}ASAP{% elif jirapriority == 'High' %}H{% elif jirapriority == 'Low' or jirapriority == 'Lowest' %}L{% else %}M{% endif %}"
add_tags = ["jira", "jira_cleanup", "bw"]
area_template = "seqera"
# Map Jira status to TaskWarrior status
status_map = [
    { upstream = "Backlog", taskwarrior = "waiting" },
    { upstream = "To Do", taskwarrior = "pending" },
    { upstream = "In Progress", taskwarrior = "pending" },
    { upstream = "In Review", taskwarrior = "pending" },
    { upstream = "Blocked", taskwarrior = "waiting" },
]

# =============================================================================
# GitHub - Seqera (nextflow-io, seqeralabs, seqera-services)
# =============================================================================

[github_seqera_issues]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "{{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:issue assignee:edmundmiller is:open updated:>=2025-09-09 org:nextflow-io org:seqeralabs org:seqera-services"
include_user_issues = false
include_user_repos = false
add_tags = ["github", "bw", "assigned"]
# TODO: Review GitHub default priorities - should these be higher?
default_priority = "L"
area_template = "seqera"

# PRs you authored - need to follow up on feedback/reviews
[github_seqera_authored_prs]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "{{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:pr author:edmundmiller is:open updated:>=2025-09-09 org:nextflow-io org:seqeralabs org:seqera-services -author:app/renovate -author:app/dependabot"
include_user_issues = false
include_user_repos = false
add_tags = ["authored_pr", "github", "bw"]
default_priority = "L"
area_template = "seqera"

# PRs where you're requested as reviewer - don't drop the ball!
[github_seqera_review_requests]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "Review {{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:pr review-requested:edmundmiller is:open org:nextflow-io org:seqeralabs org:seqera-services"
include_user_issues = false
include_user_repos = false
add_tags = ["review_request", "github", "bw"]
# TODO: Should review requests be H since people are waiting on you?
default_priority = "M"
area_template = "seqera"

# PRs assigned to you but not authored (bot PRs, handoffs)
[github_seqera_assigned_prs]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "Assigned {{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:pr assignee:edmundmiller -author:edmundmiller is:open org:nextflow-io org:seqeralabs org:seqera-services"
include_user_issues = false
include_user_repos = false
add_tags = ["assigned_pr", "github", "bw"]
default_priority = "L"
area_template = "seqera"

# =============================================================================
# GitHub - nf-core (nf-core, bioinformaticsorphanage, bioconda)
# =============================================================================

[github_nfcore_issues]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "{{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:issue assignee:edmundmiller is:open updated:>=2025-09-09 org:nf-core org:bioinformaticsorphanage org:bioconda"
include_user_issues = false
include_user_repos = false
add_tags = ["github", "bw", "assigned"]
default_priority = "L"
area_template = "nfcore"

# PRs you authored - need to follow up on feedback/reviews
[github_nfcore_authored_prs]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "{{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:pr author:edmundmiller is:open updated:>=2025-09-09 org:nf-core org:bioinformaticsorphanage org:bioconda -author:app/renovate -author:app/dependabot"
include_user_issues = false
include_user_repos = false
add_tags = ["authored_pr", "github", "bw"]
default_priority = "L"
area_template = "nfcore"

# PRs where you're requested as reviewer - don't drop the ball!
[github_nfcore_review_requests]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "Review {{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:pr review-requested:edmundmiller is:open org:nf-core org:bioinformaticsorphanage org:bioconda"
include_user_issues = false
include_user_repos = false
add_tags = ["review_request", "github", "bw"]
default_priority = "M"
area_template = "nfcore"

# PRs assigned to you but not authored (bot PRs, handoffs)
[github_nfcore_assigned_prs]
service = "github"
login = "edmundmiller"
token = "@oracle:eval:cat ~/.config/bugwarrior/secrets/github-work-token"
username = "edmundmiller"
description_template = "Assigned {{githubtitle}}"
project_template = "{{githubrepo|replace('/', '.')}}"
query = "is:pr assignee:edmundmiller -author:edmundmiller is:open org:nf-core org:bioinformaticsorphanage org:bioconda"
include_user_issues = false
include_user_repos = false
add_tags = ["assigned_pr", "github", "bw"]
default_priority = "L"
area_template = "nfcore"

# =============================================================================
# Gmail (TODO)
# =============================================================================

# TODO: Configure work Gmail integration
# Requires OAuth setup - see https://bugwarrior.readthedocs.io/en/latest/services/gmail.html
# 1. Create Google Cloud project
# 2. Enable Gmail API
# 3. Create OAuth credentials
# 4. Download client secret to ~/.gmail_client_secret.json
# 5. Run bugwarrior-pull once to complete OAuth flow
# 6. Uncomment target below and add to targets list
#
# [work_gmail]
# service = "gmail"
# query = "label:action OR label:todo"
# login_name = "edmund.miller@seqera.io"
# add_tags = ["gmail", "bw"]
# area_template = "seqera"
