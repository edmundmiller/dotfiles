{
  // Docs: https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/settings.md
  "$schema": "./settings-schema.json",
  // Model configuration - Sonnet 4.6 as default
  "defaultProvider": "anthropic",
  "defaultModel": "claude-sonnet-4-6",
  "defaultThinkingLevel": "medium",
  // Model cycling - Ctrl+P to toggle between these
  "enabledModels": ["claude-sonnet-4-6", "claude-opus-4-6", "claude-haiku-4-5", "gpt-5.3-codex"],
  // UI preferences
  "theme": "dark",
  "quietStartup": false,
  "doubleEscapeAction": "tree",
  "editorPaddingX": 1,
  // Compaction - keep more context for complex tasks
  "compaction": {
    "enabled": true,
    "reserveTokens": 16384,
    "keepRecentTokens": 24000,
  },
  // Retry configuration
  "retry": {
    "enabled": true,
    "maxRetries": 3,
    "baseDelayMs": 2000,
  },
  // Message delivery - one at a time for control
  "steeringMode": "one-at-a-time",
  "followUpMode": "one-at-a-time",
  // Images
  "images": {
    "autoResize": true,
    "blockImages": false,
  },
  // Skills as commands - also registers skills as /skill:name slash commands
  // Docs: https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/skills.md
  "enableSkillCommands": true,
  // Permission system - layered command control via pi-hooks/permission
  // Docs: https://github.com/prateekmedia/pi-hooks/tree/main/permission
  "permissionLevel": "high",
  "permissionMode": "ask",
  "permissionConfig": {
    "overrides": {
      // Hard-deny via dangerous: --no-verify, signing bypass, identity spoofing
      // These always prompt even at high level; enforce-hooks.ts hard-blocks them
      "dangerous": [
        "git commit *--no-verify*",
        "git commit *-n *",
        "git push *--no-verify*",
        "git commit *--no-gpg-sign*",
        "git push *--no-gpg-sign*",
        "git commit *--author*",
        "*-c user.email=*",
        "*-c user.name=*",
        "*-c commit.gpgsign=false*",
        "*gpgsign=false*",
        "*--no-verify*",
        "*--no-gpg-sign*",
        "*core.hooksPath*",
        "HUSKY=0 *",
        "SKIP=* *",
        "PRE_COMMIT_ALLOW_NO_CONFIG=* *",
        "GIT_AUTHOR_NAME=* *",
        "GIT_AUTHOR_EMAIL=* *",
        "GIT_COMMITTER_NAME=* *",
        "GIT_COMMITTER_EMAIL=* *",
        "jj git push *--no-verify*",
      ],
      // Nix/dotfiles ops are routine in this repo
      "medium": ["nix *", "darwin-rebuild *", "hey *"],
    },
  },
  // Packages - https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/packages.md
  "packages": [
    {
      "source": "shitty-extensions",
      "extensions": [
        "clipboard.ts",
        "oracle.ts",
        "memory-mode.ts",
        "plan-mode.ts",
        "handoff.ts",
        "usage-bar.ts",
        "ultrathink.ts",
        "status-widget.ts",
        "cost-tracker.ts",
        "funny-working-message.ts",
        "speedreading.ts",
        "loop.ts",
        "process-info.ts", // writes PID/tmux pane/session/status into session JSONL (for pi-sessions picker)
      ],
      "skills": [],
    },
    // Git-backed agent memory filesystem (inspired by Letta Code)
    "~/.config/dotfiles/pi-packages/pi-context-repo",
    // Dynamic context pruning - forked from https://github.com/zenobi-us/pi-dcp
    "~/.config/dotfiles/pi-packages/pi-dcp",
    // Secure web fetch – HTML→markdown via mdream, secret scanning, injection detection
    "~/.config/dotfiles/pi-packages/pi-scurl",
    // Auto-load direnv env at session start
    "~/.config/dotfiles/pi-packages/pi-direnv",
    // Prevent hangs on interactive commands (GIT_EDITOR=true, PAGER=cat, etc.)
    "~/.config/dotfiles/pi-packages/pi-non-interactive",
    // Git-stash for prompt drafts (ctrl+s/ctrl+shift+s)
    "~/.config/dotfiles/pi-packages/pi-prompt-stash",
    // Cross-agent thread reader (agents:// URIs)
    "~/.config/dotfiles/pi-packages/pi-xurl",
    // Rhubarb Pi collection - https://github.com/qualisero/rhubarb-pi
    {
      "source": "https://github.com/qualisero/rhubarb-pi",
      "extensions": [
        "hooks/background-notify",
        "hooks/session-color",
        "extensions/safe-git",
        // "extensions/pi-agent-scip" // SCIP for typescript/python - requires scip CLI
      ],
    },
    // tmustier extensions - https://github.com/tmustier/pi-extensions
    {
      "source": "git:github.com/tmustier/pi-extensions",
      "extensions": [
        "tab-status/tab-status.ts",
        "files-widget/index.ts",
        "code-actions/index.ts", // /code to pick code blocks from messages
        "raw-paste/index.ts", // /paste for raw clipboard paste
        "agent-guidance/agent-guidance.ts", // Agent guidance/steering
      ],
      "skills": [],
    },
    // Canvas for visual diagrams - https://github.com/jyaunches/pi-canvas
    {
      "source": "https://github.com/jyaunches/pi-canvas",
      "extensions": ["pi-extension/index.ts"],
    },
    // Permission system - https://github.com/prateekmedia/pi-hooks
    {
      "source": "https://github.com/prateekmedia/pi-hooks",
      "extensions": ["permission/permission.ts"],
    },
    // LSP - standalone npm package (extracted from pi-hooks)
    "npm:lsp-pi",
    // Amp-like features (session query, handoff) - https://github.com/pasky/pi-amplike
    {
      "source": "https://github.com/pasky/pi-amplike",
      "extensions": ["extensions/session-query.ts", "extensions/handoff.ts"],
      "skills": ["skills/session-query"],
    },
    // GitHub repo tools (read/search/explore) - https://github.com/PriNova/pi-github-tools
    "npm:@prinova/pi-github-tools",
    // Task management UI (ctrl+x) - beads (bd) integration
    "~/.config/dotfiles/pi-packages/pi-beads",
    // Fuzzy file picker (ctrl+f) - https://github.com/kaofelix/pi-fzf
    "npm:pi-fzf",
    // Profile/settings switcher - https://www.npmjs.com/package/pi-codex-profile
    "npm:pi-codex-profile",
    // Usage quota widget (bundles sub-core) - https://github.com/marckrenn/pi-sub
    "npm:@marckrenn/pi-sub-bar",
    // Semaphore/lock primitives (dep of pi-tmux) - https://github.com/offline-ant/pi-semaphore
    {
      "source": "git:github.com/offline-ant/pi-semaphore",
      "extensions": ["extensions/semaphore-locks.ts"],
      "skills": [],
    },
    // Tmux pane control (bash, capture, send, kill, spawn agents) - https://github.com/offline-ant/pi-tmux
    {
      "source": "git:github.com/offline-ant/pi-tmux",
      "extensions": ["extensions/tmux.ts", "extensions/supervisor.ts"],
      "skills": [],
    },
    // Dumb zone - context degradation warning - https://github.com/aliou/pi-extensions
    {
      "source": "https://github.com/aliou/pi-extensions",
      "extensions": ["extensions/the-dumb-zone"],
    },
    // Ghostty title bar, spinner, progress bar - https://github.com/HazAT/pi-ghostty
    "npm:pi-ghostty",
    // Ghostty theme sync - https://github.com/ogulcancelik/pi-ghostty-theme-sync
    "npm:pi-ghostty-theme-sync",
    // Entire.io code context - https://github.com/entireio/cli
    "npm:@hjanuschka/pi-entire",
    // Notification on task completion - https://github.com/ferologics/pi-notify
    "npm:pi-notify",
    // Multi-agent messaging/coordination - https://github.com/nicobailon/pi-messenger
    "npm:pi-messenger",
    // Interactive shell tool - https://github.com/nicobailon/pi-interactive-shell
    "npm:pi-interactive-shell",
    // Subagent delegation with chains, parallel execution, TUI - https://github.com/nicobailon/pi-subagents
    "npm:pi-subagents",
    // Mermaid diagram rendering - https://www.npmjs.com/package/pi-mermaid
    "npm:pi-mermaid",
    // MCP adapter - lazy-load MCP servers without burning context - https://github.com/nicobailon/pi-mcp-adapter
    "npm:pi-mcp-adapter",
  ],
}
