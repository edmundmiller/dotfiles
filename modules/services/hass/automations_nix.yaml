# Nix-managed automations â€” edit in dotfiles, deploy with hey nuc
# UI-created automations live in automations.yaml (separate)

# --- Goodnight routine ---
- alias: "Goodnight - everything off"
  id: goodnight_everything_off
  trigger:
    - platform: state
      entity_id: input_boolean.goodnight
      to: "on"
  action:
    - action: media_player.turn_off
      target:
        entity_id: media_player.tv
    - action: input_select.select_option
      target:
        entity_id: input_select.house_mode
      data:
        option: Night

- alias: "Good Morning - reset night mode"
  id: good_morning_reset
  trigger:
    - platform: state
      entity_id: input_boolean.goodnight
      to: "off"
  action:
    - action: input_select.select_option
      target:
        entity_id: input_select.house_mode
      data:
        option: Home

# --- Movie mode ---
- alias: "Movie mode on"
  id: movie_mode_on
  trigger:
    - platform: state
      entity_id: input_select.house_mode
      to: "Movie"
  action:
    - action: media_player.turn_on
      target:
        entity_id: media_player.tv

- alias: "Movie mode off"
  id: movie_mode_off
  trigger:
    - platform: state
      entity_id: input_select.house_mode
      from: "Movie"
  action: []
  # Add light restore here when you have smart lights

# --- Away mode ---
- alias: "Away mode - turn off media"
  id: away_mode_media_off
  trigger:
    - platform: state
      entity_id: input_select.house_mode
      to: "Away"
  action:
    - action: media_player.turn_off
      target:
        entity_id: media_player.tv

# --- TV idle auto-off (2hr) ---
- alias: "TV auto-off after 2 hours idle"
  id: tv_idle_auto_off
  trigger:
    - platform: state
      entity_id: media_player.tv
      to: "idle"
      for:
        hours: 2
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: "Night"
  action:
    - action: media_player.turn_off
      target:
        entity_id: media_player.tv

# --- TV sleep timer ---
- alias: "TV sleep timer - start"
  id: tv_sleep_timer_start
  trigger:
    - platform: state
      entity_id: input_number.tv_sleep_timer
  condition:
    - condition: template
      value_template: "{{ states('input_number.tv_sleep_timer') | int > 0 }}"
  action:
    - action: timer.start
      target:
        entity_id: timer.sleep
      data:
        duration: "{{ states('input_number.tv_sleep_timer') | int * 60 }}"

- alias: "TV sleep timer - expired"
  id: tv_sleep_timer_expired
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.sleep
  action:
    - action: media_player.turn_off
      target:
        entity_id: media_player.tv
    - action: input_number.set_value
      target:
        entity_id: input_number.tv_sleep_timer
      data:
        value: 0

# --- DND suppresses notifications ---
- alias: "DND on - suppress notifications"
  id: dnd_on
  trigger:
    - platform: state
      entity_id: input_boolean.do_not_disturb
      to: "on"
  action:
    - action: notify.persistent_notification
      data:
        message: "Do Not Disturb is active"
        title: "ðŸ”• DND"

# --- Daily TV counter reset ---
- alias: "Reset TV counter daily"
  id: reset_tv_counter_daily
  trigger:
    - platform: time
      at: "00:00:00"
  action:
    - action: counter.reset
      target:
        entity_id: counter.tv_on_today

- alias: "Count TV sessions"
  id: count_tv_sessions
  trigger:
    - platform: state
      entity_id: media_player.tv
      to: "playing"
  action:
    - action: counter.increment
      target:
        entity_id: counter.tv_on_today
