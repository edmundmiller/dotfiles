#!/usr/bin/env bash
#MISE description="Bump version - handles 'next' prerelease or syncs after 'latest'"
#USAGE flag "-t --tag <tag>" "Tag for versioning strategy (next|latest)" default="next"

set -e

echo "Bumping version"
echo " > with tag: ${usage_tag}..."

# When bumping "next": prerelease bump only
# When "latest": release-please handles it, but we sync "next" to be ahead
if [ "${usage_tag}" = "next" ]; then
  echo "Bumping prerelease version for 'next' tag..."
  bun pm version prerelease
  echo " > Next version: $(jq -r '.version' package.json)"
  
elif [ "${usage_tag}" = "latest" ]; then
  echo "Syncing 'next' tag to be ahead of 'latest'..."
  echo "(Note: 'latest' version should already be bumped by release-please)"
  
  # Get current version (should be latest after release-please)
  LATEST_VERSION=$(jq -r '.version' package.json)
  echo " > Latest version: $LATEST_VERSION"
  
  # Bump to next prerelease (X.Y.Z -> X.Y.(Z+1)-prerelease.0)
  echo " > Bumping 'next' to be ahead of latest..."
  bun pm version prerelease
  
  NEXT_VERSION=$(jq -r '.version' package.json)
  echo " > Next version: $NEXT_VERSION"
  
else
  echo "‚ùå Unknown tag: ${usage_tag}"
  echo "   Use: --tag next (default) or --tag latest"
  exit 1
fi

echo "Version bump completed!"
